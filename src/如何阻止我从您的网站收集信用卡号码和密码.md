# 第2部分：如何阻止我从您的网站收集信用卡号码和密码

> 译者：原文：[Part 2: How to stop me harvesting credit card numbers and passwords from your site](https://hackernoon.com/part-2-how-to-stop-me-harvesting-credit-card-numbers-and-passwords-from-your-site-844f739659b9)，以下为译文：

我最近写了[一篇文章](https://hackernoon.com/part-2-how-to-stop-me-harvesting-credit-card-numbers-and-passwords-from-your-site-844f739659b9)（[译文](https://github.com/luke93h/git-blog/issues/22)），描述了我如何注入恶意代码，这些代码以一种很难检测到的方式从数千个网站收集信用卡号和密码。

这篇文章收到的评论让我感到高兴，比如“令人不寒而栗”，“令人不安”和“完全可怕”等情感。（就像我在舞池上收到的赞美一样。）

在这篇文章中，我会提出一些实用的建议。

# 概要

* 没必要杜绝使用第三方代码
* 收集或展示敏感信息时，请在单独的HTML文件中完成，并确保该html中没有第三方代码。
* 在iframe中显示此文件
* 从不同域上的静服务器提供此文件
* 您还可以考虑通过使用第三方登录和第三方来收集和处理信用卡信息来完全避免敏感数据。

您还可以考虑通过使用第三方登录和第三方来收集和处理信用卡信息，来完全避免敏感数据。

我在这篇文章中建议的东西只适用于敏感信息（密码，信用卡号等）非常有限且可以隔离开的网站。如果的网页是聊天应用或电子邮件客户端或数据库GUI（所有数据是敏感的），我无能为力。

# 十八倍长的版本

我认为适当的恐惧是不错的开始。

我建议您想象一下，当您看到OnePlus [最近发布的公告](https://forums.oneplus.com/threads/jan-19-update-an-update-on-credit-card-security.752415/)时，会是什么样的感觉：

> ...支付页面被注入恶意脚本，信用卡信息泄漏...恶意脚本间歇性地操作，直接从用户的浏览器捕获并发送数据... oneplus.net上的多达40k用户可能会受到影响事件发生

钱！

***

现在让我们把用更具象的东西来感受这种模糊的恐惧感。

也许动物有用......

如果把第三方代码比作一个条杜宾犬。尽管它看起来平静，温柔。但是在它那黑色，不眨眼的眼睛里，有一种未知的闪烁。我只想说，我不会把我珍爱的东西放在它的附近。

可以把用户的敏感信息描看做一只可爱的小仓鼠。我看着它无辜地舔着它的小前脚，梳理它愚蠢的小脸，小仓鼠完全没有注意到杜宾犬，并在它面前随意嬉戏。

如果你曾经养过杜宾犬（强烈推荐），你可能知道他们是美妙，温和的生物，不应该因为恶毒而得名。尽管如此，我相信你肯定会同意，让小仓鼠和杜宾犬独处是个坏主意。

当然，你下班回到家后，也许会看到Bagnt Pants教授睡着在Chompers中士的背上的可爱场景。也有仓鼠曾经待着的位置啥也没了，以及一只头歪向一边的狗，好像在问“今天我的甜点是什么呢？”

***

我不认为来自npm，GTM或DFP或其他任何地方的代码应该被贴上不安全的标签。但我建议，除非你能保证这段代码是可信的，否则未将其与用户的敏感信息分开是不负责任的。

所以...这就是我建议大家采用的心态：敏感信息和第三方代码不应该同时存在。

## 一个例子：修复易受攻击的网站

此示例中的网站中有易受第三方恶意代码攻击的信用卡表单，就像您可能认为在安全性方面更好的几个非常大的电子商务网站上的那些。

![yewai](https://github.com/luke93h/git-blog/blob/master/imgs/anquan.png?raw=true)

此页面充满了第三方代码。它使用了React，并通过Create React App创建，所以它在我开始之前有886个npm包（严重）。

它也有谷歌标签管理器（ Google Tag Manager，是一个方便的方式，它可以让你从来没有遇到过的人将JavaScript注入你的网站，而不需要经过代码审查）。

另外，我还有一个横幅广告。这是互联网上的一则广告，因此自然需要分布在112个网络请求上总共1.5 MB的JavaScript，有11秒时间完全倾斜在CPU上，以加载单个动画gif，同时信用卡信息飞一般被发送出去。

（咆哮：为此我对谷歌很失望。他们的开发人员花很多时间教我们如何快速制作网页;在这里刮掉几十千字节，在那里刮几毫秒 - 这是很棒的东西。但同时他们允许DFP广告联盟向用户的设备发送数兆资源，发起数百个网络请求，并有数秒时间塞满CPU。谷歌，我知道您能想到更好的办法来提供更智能，更快捷的广告投放方式。）

***

好的，回到正题......显然，我需要做的是把用户的敏感信息保护起来，远离所有第三方恶意代码 ; 我希望它们能待在属于自己的小岛上。

![yewai](https://github.com/luke93h/git-blog/blob/master/imgs/xiaodao.jpeg?raw=true)

现在，你已经看完了本文的2/5，我将开始讲述一些实用的方法。

* 选项1：将信用卡表单移动到没有第三方JavaScript的document中，并将其作为单独的页面
* 选项2：与选项1相同，但页面在iframe中提供
* 选项3：与选项2相同，但父页面和iframe通过相互通信 postMessage

## 选项1：敏感数据的单独页面

最简单的方法是创建一个没有JavaScript的全新页面。当用户点击“购买”，而不是向他们显示当前页面中包含的一些光滑形式时，我会将它们发送到以下内容

![yewai](https://github.com/luke93h/git-blog/blob/master/imgs/anquan1.png.jpeg?raw=true)